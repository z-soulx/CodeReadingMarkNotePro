# Code Reading Note Pro - 同步功能使用指南

## 功能概述

同步功能允许您将代码阅读笔记同步到独立的远程仓库，实现跨设备、跨项目的笔记数据共享和备份。

### 主要特性

- **独立存储**: 笔记数据存储在独立的GitHub仓库，不污染项目代码仓库
- **多项目支持**: 一个同步仓库可以管理多个项目的笔记
- **跨设备同步**: 在不同机器上的相同项目间同步笔记数据
- **灵活策略**: 支持覆盖或合并两种同步模式
- **可扩展架构**: 未来将支持更多同步方式（Gitee、WebDAV等）

## 快速开始

### 1. 准备工作

#### 1.1 创建专用GitHub仓库

在GitHub上创建一个新的私有仓库用于存储笔记数据，例如：`my-code-reading-notes`

#### 1.2 生成Personal Access Token

1. 访问 GitHub Settings → Developer settings → Personal access tokens → Tokens (classic)
2. 点击 "Generate new token (classic)"
3. 设置Token名称，如 "CodeReadingNoteSync"
4. 勾选权限：
   - ✅ `repo` (完整仓库访问权限)
5. 生成并保存Token（只显示一次，请妥善保管）

### 2. 配置同步

#### 2.1 打开设置界面

在IntelliJ IDEA中：
- Windows/Linux: `File → Settings → Tools → Code Reading Note Sync`
- macOS: `IntelliJ IDEA → Preferences → Tools → Code Reading Note Sync`

#### 2.2 填写配置信息

1. **启用同步**: 勾选 "启用同步"
2. **同步方式**: 选择 "GitHub" (当前版本)
3. **自动同步**: 可选，勾选后每次保存笔记会自动推送
4. **仓库地址**: 格式为 `username/repo-name`
   - 例如: `zhangsan/my-code-reading-notes`
5. **访问令牌**: 粘贴刚才生成的Personal Access Token
6. **分支**: 默认 `main`，可自定义
7. **基础路径**: 默认 `code-reading-notes`，笔记存储的目录

点击 "Apply" 保存配置。

### 3. 使用同步功能

#### 3.1 推送笔记到远程

在 Code Reading Note Pro 工具窗口的工具栏中：
1. 点击 **Push to Remote** 按钮（向上箭头图标）
2. 等待推送完成
3. 查看提示信息确认推送成功

**推送后的仓库结构：**
```
my-code-reading-notes/
└── code-reading-notes/
    ├── myjava/               # myjava项目的笔记
    │   └── CodeReadingNote.xml
    └── spring-boot-demo/     # spring-boot-demo项目的笔记
        └── CodeReadingNote.xml
```

每个项目直接使用项目名称作为文件夹名，**清晰易读，便于管理**。

#### 3.2 从远程拉取笔记

1. 点击 **Pull from Remote** 按钮（向下箭头图标）
2. 选择拉取模式：
   - **合并**: 保留本地数据，添加远程数据（推荐）
   - **覆盖**: 用远程数据完全替换本地数据（慎用）
3. 确认后等待拉取完成

#### 3.3 合并策略说明

- **合并模式**: 
  - 相同主题名称时，比较更新时间，保留较新的版本
  - 不同主题名称时，两者都保留
  - 适合多设备协作使用

- **覆盖模式**: 
  - 清空本地所有笔记
  - 用远程数据完全替换
  - 适合重新初始化或回滚到远程版本

## 使用场景

### 场景1: 跨设备同步

**电脑A (公司)**
1. 在项目中做笔记
2. 点击 Push 推送到GitHub

**电脑B (家里)**
1. 打开同一项目
2. 点击 Pull (合并模式)
3. 获取公司做的笔记
4. 继续添加新笔记
5. 点击 Push 推送更新

### 场景2: 团队分享笔记

1. 团队成员共享同一个GitHub仓库
2. 配置相同的同步设置
3. 各自Push自己的笔记
4. Pull时选择合并模式
5. 实现笔记知识共享

### 场景3: 备份恢复

1. 定期Push笔记到远程
2. 如果本地数据丢失
3. Pull (覆盖模式) 恢复数据

## 高级配置

### 自动同步

启用 "自动同步" 后：
- 每次添加/修改主题时自动Push
- 无需手动点击Push按钮
- 适合频繁更新笔记的场景
- **注意**: 需要稳定的网络连接

### 自定义基础路径

可以修改 "基础路径" 来自定义远程存储位置：
- 默认: `code-reading-notes`
- 自定义示例: `my-notes/reading` 或 `team/shared-notes`

### 多分支管理

可以使用不同分支存储不同版本的笔记：
- `main` 分支: 稳定版本笔记
- `dev` 分支: 实验性笔记
- `personal` 分支: 个人笔记

## 故障排除

### 推送失败

**问题**: "推送失败: 401 Unauthorized"
- **原因**: Token无效或权限不足
- **解决**: 重新生成Token并确保有 `repo` 权限

**问题**: "推送失败: 404 Not Found"
- **原因**: 仓库地址错误或无访问权限
- **解决**: 检查仓库地址格式 `owner/repo`

**问题**: "推送失败: 网络超时"
- **原因**: 网络连接问题
- **解决**: 检查网络连接和代理设置

### 拉取失败

**问题**: "远程文件不存在"
- **原因**: 首次使用，远程还没有数据
- **解决**: 先执行一次Push

**问题**: "解析远程数据失败"
- **原因**: 远程文件格式不正确
- **解决**: 检查是否手动修改了远程XML文件

### 合并冲突

目前的合并策略是基于时间戳的简单策略，以更新时间较新的为准。如果需要更复杂的合并逻辑，建议：
1. 拉取前先导出本地笔记备份
2. 使用覆盖模式拉取
3. 手动导入之前的备份
4. 人工处理冲突

## 安全建议

1. **Token安全**
   - 不要将Token提交到代码仓库
   - 定期更换Token
   - 使用最小权限原则

2. **私有仓库**
   - 建议使用私有仓库存储笔记
   - 避免敏感信息泄露

3. **定期备份**
   - 除了同步，也要定期使用导出功能本地备份
   - 多重备份保障数据安全

## 未来规划

v1.0 版本支持GitHub同步，后续版本将支持：

- ✅ GitHub (已实现)
- ⏳ Gitee (国内用户)
- ⏳ GitLab
- ⏳ WebDAV (私有云存储)
- ⏳ 本地文件系统同步
- ⏳ 冲突检测和解决
- ⏳ 增量同步优化

## 技术架构

### 可扩展设计

同步功能采用策略模式设计，支持轻松添加新的同步方式：

```
SyncProvider (接口)
├── GitHubSyncProvider (已实现)
├── GiteeSyncProvider (计划中)
├── WebDAVSyncProvider (计划中)
└── LocalFileSyncProvider (计划中)
```

### 数据格式

同步的数据格式与导出功能相同，使用XML格式：
- 完整保留主题、分组、代码行、备注信息
- 支持版本兼容
- 便于人工查看和编辑

## 常见问题

**Q: 同步会影响项目的Git仓库吗？**
A: 不会。笔记数据存储在独立的远程仓库，完全独立于项目代码。

**Q: 可以同步到项目仓库吗？**
A: 技术上可以，但不推荐。建议使用独立仓库避免污染项目历史。

**Q: 多个项目可以用同一个同步仓库吗？**
A: 可以。每个项目有唯一标识符，自动隔离存储。

**Q: 支持私有部署的GitHub企业版吗？**
A: 当前版本使用公共GitHub API，如需支持企业版可以联系开发者。

**Q: Token会被明文存储吗？**
A: Token存储在IDE的配置文件中，建议设置好文件权限保护。

## 反馈与支持

如有问题或建议，请：
- 提交Issue: [GitHub Issues](https://github.com/your-repo/issues)
- 邮件联系: 170918810@qq.com
- 插件主页: https://plugins.jetbrains.com/plugin/24163-code-reading-mark-note-pro

祝使用愉快！

