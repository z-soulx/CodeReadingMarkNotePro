# Code Reading Mark Note Pro - 项目上下文

## 项目概览

**Code Reading Mark Note Pro** 是一个IntelliJ IDEA插件，帮助开发者在阅读代码时做笔记和标记。
- **插件ID**: `soulx.CodeReadingMarkNotePro`
- **版本**: 3.6.0
- **平台**: IntelliJ IDEA 2024.3+
- **技术栈**: Java 17 + Gradle

## 核心功能

### 基础功能
- **主题管理**: 创建组织代码阅读主题
- **代码标记**: 为代码行添加备注和书签
- **编辑器集成**: 内联显示代码备注

### 增强功能
- **分组管理**: 标签分组和自定义命名
- **自动同步**: GitHub自动同步，带冲突检测和防数据丢失
- **多语言支持**: 英文/中文界面切换

### 同步特性
- **冲突检测**: MD5+时间戳双重校验，防止旧数据覆盖
- **状态显示**: 实时同步状态（已同步/待同步/同步中/冲突暂停）
- **冲突解决**: 用户友好的对话框，手动选择Pull/Push/Cancel
- **启动检查**: 项目打开时自动检测冲突


## 系统架构

### 核心组件
- **服务层**: 插件核心服务，管理状态和持久化
- **领域模型**: Topic（主题）和TopicLine（代码行）实体
- **同步管理**: 冲突检测、状态管理、自动同步调度
- **UI层**: 工具窗口、面板和对话框组件
- **动作系统**: 用户操作的Action实现
- **集成层**: 编辑器集成、书签联动、多语言支持

### 设计理念
- **模块化设计**: 功能独立，便于扩展
- **事件驱动**: 使用MessageBus进行组件通信
- **数据安全**: 冲突检测防止数据丢失
- **关注点分离**: 业务数据与客户端状态分离存储
- **插件架构**: 充分利用IntelliJ Platform API

## 关键技术点

- **状态持久化**: 使用IntelliJ的PersistentStateComponent
- **事件通信**: MessageBus进行组件间解耦
- **UI集成**: ToolWindow和Editor集成
- **自动同步**: 基于数据持久化触发，带防抖机制
- **冲突检测**: MD5+时间戳双重校验
- **状态管理**: 完整的同步状态机（DIRTY/PENDING/SYNCING/SYNCED/ERROR）
- **多语言**: 运行时语言切换，无需重启

## 数据存储设计

- **业务数据** (`CodeReadingNote.xml`): Topics、Lines、Groups → 同步到远端
- **客户端状态** (`syncStatus.xml`): 同步时间、MD5缓存 → 本地保留
- **同步配置** (`codeReadingNoteSync.xml`): Token、仓库地址 → 应用级

## 开发原则

- **向后兼容**: 保持数据格式兼容性
- **用户体验**: 注重代码阅读工作流
- **模块化**: 功能独立，易于扩展
- **资源管理**: 正确清理监听器和资源
- **数据安全**: 防止数据丢失，用户确认关键操作

## 版本信息

- **当前版本**: 3.6.0 (多语言 + Auto-Sync)
- **技术栈**: Java 17 + IntelliJ Platform + Gradle

## 相关文档

- **开发规则**: `DEVELOPMENT_RULES.md` - 通用开发规范
- **临时文档**: `tmpmd/` - 开发过程文档存放地
- **使用指南**: `manual_prompts/` - 版本发布和上下文优化指南
