# IntelliJ插件版本兼容性策略

## 当前配置说明

### 向前兼容配置
我们的插件现在配置为**向前兼容**，支持2024.3及之后的所有版本，包括未来的2025.1、2025.2等版本。

### 配置详解

#### 1. plugin.xml配置
```xml
<idea-version since-build="243" until-build="*.*"/>
```
- `since-build="243"`: 支持从2024.3开始的版本
- `until-build="*.*"`: 支持所有未来版本（无上限）

#### 2. build.gradle配置
```gradle
patchPluginXml {
    sinceBuild.set('243')    // 从2024.3开始
    untilBuild.set('')       // 空字符串表示支持所有未来版本
}

runPluginVerifier {
    ideVersions.set(['2024.3', 'LATEST-EAP-SNAPSHOT'])
    failureLevel.set([RunPluginVerifierTask.FailureLevel.COMPATIBILITY_PROBLEMS])
}
```

## 版本号说明

IntelliJ版本号格式：`YYYY.R.P`
- `YYYY`: 年份
- `R`: 季度发布号 (1, 2, 3)
- `P`: 补丁版本号

内部构建号格式：
- 2024.1 → 241
- 2024.2 → 242  
- 2024.3 → 243
- 2025.1 → 251

## 优势

### ✅ 一次编译，多版本支持
- 编译一次就能支持2024.3, 2025.1, 2025.2等所有未来版本
- 不需要为每个季度版本单独编译
- 大大减少维护工作量

### ✅ 自动向前兼容
- 用户升级到新版本IDEA时，插件自动可用
- 无需等待插件更新

### ✅ 持续验证
- `LATEST-EAP-SNAPSHOT`会测试最新的开发版本
- 提前发现兼容性问题

## 注意事项

### ⚠️ API稳定性风险
- 新版本可能引入破坏性API变更
- 需要关注IntelliJ平台的API变更通知

### ⚠️ 定期验证
建议定期运行插件验证：
```bash
./gradlew runPluginVerifier
```

### ⚠️ 监控用户反馈
- 新版本发布后关注用户反馈
- 及时修复兼容性问题

## 最佳实践

### 1. 保守的API使用
- 只使用稳定的、文档化的API
- 避免使用内部API或实验性功能
- 及时修复过期API警告

### 2. 充分测试
- 在多个版本上测试插件功能
- 使用自动化测试覆盖核心功能
- 关注IntelliJ平台的兼容性测试结果

### 3. 版本策略
- 使用最低支持版本进行编译（2024.3）
- 确保代码不依赖更高版本的特性
- 在需要时可以动态检测版本并调整行为

## 如果遇到兼容性问题

### 方案1：条件性API使用
```java
// 检查版本并使用不同的API
if (ApplicationInfo.getInstance().getBuild().getBaselineVersion() >= 251) {
    // 使用2025.1+的新API
} else {
    // 使用旧API
}
```

### 方案2：缩小兼容范围
如果无法解决兼容性问题，可以临时缩小支持范围：
```gradle
untilBuild.set('243.*')  // 只支持到2024.3.x
```

### 方案3：多版本构建
在极端情况下，可以为不同版本范围构建不同的插件包。

## 监控和维护

### 定期检查
- 每个季度检查新版本兼容性
- 关注JetBrains的API变更公告
- 监控插件市场的兼容性报告

### 用户沟通
- 在插件描述中明确支持的版本范围
- 提供清晰的更新日志
- 及时响应用户的兼容性问题反馈

这种配置让你的插件能够"一劳永逸"地支持未来版本，大大减少维护成本。
